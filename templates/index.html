{{ template "header" . }}

<div class="row">
  <!-- ==================== QUERY DOMAINS / IPs CARD ==================== -->
  <div class="col-md-5">
    <div class="card shadow-sm">
      <div class="card-body">
        <h3 class="card-title">Query Domains / IPs</h3>
        <form method="post" id="queryForm">
          <div class="mb-3">
            <textarea 
              class="form-control" 
              name="ips_and_domains" 
              rows="5"
              placeholder="example.com, 8.8.8.8, github.com"
              required></textarea>
          </div>
          <div class="form-check mb-2">
            <input class="form-check-input" type="checkbox" name="whois" id="whois" {{ if .whois_enabled }}checked{{ end }}>
            <label class="form-check-label" for="whois">WHOIS</label>
          </div>
          <div class="form-check mb-2">
            <input class="form-check-input" type="checkbox" name="dns" id="dns" {{ if .dns_enabled }}checked{{ end }}>
            <label class="form-check-label" for="dns">DNS</label>
          </div>
          <div class="form-check mb-3">
            <input class="form-check-input" type="checkbox" name="ct" id="ct" {{ if .ct_enabled }}checked{{ end }}>
            <label class="form-check-label" for="ct">Certificate Transparency</label>
          </div>
          <button type="submit" class="btn btn-primary">Query</button>
        </form>
        <div class="mt-3" id="progress" style="display:none;">
          <div class="progress">
            <div class="progress-bar progress-bar-striped progress-bar-animated" style="width: 100%"></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ==================== RESULTS TABS (RIGHT COLUMN) ==================== -->
  <div class="col-md-7">
    {{ if .results }}
      <!-- Tabs -->
      <ul class="nav nav-tabs mb-3" id="resultTabs" role="tablist">
        {{ range $i, $item := .ordered_items }}
          <li class="nav-item" role="presentation">
            <button class="nav-link {{ if eq $i 0 }}active{{ end }}"
                    id="tab-{{ $i }}" data-bs-toggle="tab"
                    data-bs-target="#pane-{{ $i }}" role="tab">
              {{ $item }}
            </button>
          </li>
        {{ end }}
      </ul>

      <!-- Tab Content -->
      <div class="tab-content">
        {{ range $i, $item := .ordered_items }}
          {{ $data := index $.results $item }}
          <div class="tab-pane fade {{ if eq $i 0 }}show active{{ end }}"
               id="pane-{{ $i }}" role="tabpanel">

            <div class="card shadow-sm mb-3">
              <div class="card-header d-flex justify-content-between align-items-center">
                <strong>{{ $item }}</strong>
                <button class="btn btn-sm btn-outline-info" onclick="showHistory('{{ $item }}')">
                  History
                </button>
              </div>
              <div class="card-body">

                <!-- WHOIS -->
                {{ if $data.Whois }}
                  <details open>
                    <summary><strong>WHOIS</strong></summary>
                    <pre><code class="language-text">{{ $data.Whois }}</code></pre>
                  </details>
                {{ end }}

                <!-- DNS -->
                {{ if $data.DNS }}
                    {{ $dns := $data.DNS }}
                    
                    {{ with index $dns "A" }}
                      <details open><summary><strong>A</strong></summary><pre><code class="language-text">{{ range . }}{{ . }}{{ "\n" }}{{ end }}</code></pre></details>
                    {{ end }}
                    {{ with index $dns "AAAA" }}
                      <details open><summary><strong>AAAA</strong></summary><pre><code class="language-text">{{ range . }}{{ . }}{{ "\n" }}{{ end }}</code></pre></details>
                    {{ end }}
                    {{ with index $dns "CNAME" }}
                      <details open><summary><strong>CNAME</strong></summary><pre><code class="language-text">{{ range . }}{{ . }}{{ "\n" }}{{ end }}</code></pre></details>
                    {{ end }}
                    {{ with index $dns "NS" }}
                      <details open><summary><strong>NS</strong></summary><pre><code class="language-text">{{ range . }}{{ . }}{{ "\n" }}{{ end }}</code></pre></details>
                    {{ end }}
                    {{ with index $dns "MX" }}
                      <details open><summary><strong>MX</strong></summary><pre><code class="language-text">{{ range . }}{{ . }}{{ "\n" }}{{ end }}</code></pre></details>
                    {{ end }}
                    {{ with index $dns "TXT" }}
                      <details open><summary><strong>TXT</strong></summary><pre><code class="language-text">{{ range . }}{{ . }}{{ "\n" }}{{ end }}</code></pre></details>
                    {{ end }}
                    {{ with index $dns "PTR" }}
                      <details open><summary><strong>PTR</strong></summary><pre><code class="language-text">{{ range . }}{{ . }}{{ "\n" }}{{ end }}</code></pre></details>
                    {{ end }}
                    {{ with index $dns "SPF" }}
                      <details open><summary><strong>SPF</strong></summary><pre><code class="language-text">{{ range . }}{{ . }}{{ "\n" }}{{ end }}</code></pre></details>
                    {{ end }}
                {{ end }}

                <!-- CT -->
                {{ if $data.CT }}
                  {{ with $data.CT }}
                     <details open>
                        <summary><strong>CT Subdomains</strong></summary>
                        <ul class="list-group">
                        {{ range $k, $v := . }}
                          <li class="list-group-item"><strong>{{ $k }}</strong></li>
                        {{ end }}
                        </ul>
                     </details>
                  {{ end }}
                {{ end }}

              </div>
            </div>
          </div>
        {{ end }}
      </div>
    {{ end }}
  </div>
</div>

<!-- ==================== PORT SCANNER & TOOLS CARD ==================== -->
<div class="row mt-4">
  <!-- Port Scanner -->
  <div class="col-md-4">
    <div class="card shadow-sm h-100">
      <div class="card-header bg-info text-white d-flex justify-content-between">
        <strong>Port Scanner</strong>
        {{ if .LoggedIn }}
          <span class="badge bg-light text-dark">Ready</span>
        {{ else }}
          <span class="badge bg-warning text-dark">Login required</span>
        {{ end }}
      </div>
      <div class="card-body">
        {{ if not .LoggedIn }}
          <p class="text-muted"><em>Log in to use the scanner.</em></p>
        {{ else }}
          <form hx-post="/scan"
                hx-target="#scanResult"
                hx-swap="innerHTML"
                hx-indicator="#scanSpinner">

            <div class="mb-3">
              <label class="form-label">Target IP</label>
              <div class="input-group">
                <input type="text" class="form-control" name="target"
                       placeholder="{{ .real_ip }}">
              </div>
            </div>

            <div class="mb-3">
              <label class="form-label">Ports</label>
              <input type="text" class="form-control" name="ports"
                     value="80,443,22,21,25,3389">
            </div>

            <button type="submit" class="btn btn-info w-100">
              Scan Ports
            </button>
          </form>

          <div id="scanSpinner" class="htmx-indicator text-center mt-3">
            <div class="spinner-border spinner-border-sm text-info" role="status"></div>
          </div>
          <div id="scanResult" class="mt-3"></div>
        {{ end }}
      </div>
    </div>
  </div>

  <!-- Single DNS Lookup -->
  <div class="col-md-4">
    <div class="card shadow-sm h-100">
      <div class="card-header bg-secondary text-white">
        <strong>Single DNS Lookup</strong>
      </div>
      <div class="card-body">
        <form hx-post="/dns_lookup"
              hx-target="#dnsResult"
              hx-swap="innerHTML"
              hx-indicator="#dnsSpinner">
          <div class="mb-3">
            <label class="form-label">Domain</label>
            <input type="text" class="form-control" name="domain" placeholder="example.com" required>
          </div>
          <div class="mb-3">
            <label class="form-label">Type</label>
            <select class="form-select" name="type">
              <option value="A">A</option>
              <option value="AAAA">AAAA</option>
              <option value="MX">MX</option>
              <option value="TXT">TXT</option>
              <option value="NS">NS</option>
              <option value="CNAME">CNAME</option>
              <option value="PTR">PTR (Reverse)</option>
            </select>
          </div>
          <button type="submit" class="btn btn-secondary w-100">Lookup</button>
        </form>
        <div id="dnsSpinner" class="htmx-indicator text-center mt-3">
          <div class="spinner-border spinner-border-sm text-secondary" role="status"></div>
        </div>
        <div id="dnsResult" class="mt-3"></div>
      </div>
    </div>
  </div>

  <!-- MAC Lookup -->
  <div class="col-md-4">
    <div class="card shadow-sm h-100">
      <div class="card-header bg-dark text-white">
        <strong>MAC Lookup</strong>
      </div>
      <div class="card-body">
        <form hx-post="/mac_lookup"
              hx-target="#macResult"
              hx-swap="innerHTML"
              hx-indicator="#macSpinner">
          <div class="mb-3">
            <label class="form-label">MAC Address</label>
            <input type="text" class="form-control" name="mac" placeholder="00:11:22:33:44:55" required>
          </div>
          <button type="submit" class="btn btn-dark w-100">Lookup Vendor</button>
        </form>
        <div id="macSpinner" class="htmx-indicator text-center mt-3">
          <div class="spinner-border spinner-border-sm text-dark" role="status"></div>
        </div>
        <div id="macResult" class="mt-3"></div>
      </div>
    </div>
  </div>
</div>

<script>
  document.getElementById('queryForm').onsubmit = () => {
    document.getElementById('progress').style.display = 'block';
  };
</script>

{{ template "footer" . }}
